<!DOCTYPE html>
<html>
	<body>
	  <canvas id="myCanvas" width="800" height="600" style="border:1px solid #000000;">
	  </canvas>
	</body>
	
	<script>

		class Enemy{
			constructor(x, y, width, height, color, velocity) {
				this.x = x;
				this.y = y;
				this.width = width;
				this.height = height;
				this.color = color;
				this.velocity = velocity;
			}

			drawRectangle() {
				drawRect(this.x, this.y, this.width, this.height,this.color);
			}

			update() {
				this.y = this.y + this.velocity;
			}
		}

		class Line{
			constructor(x, y, width, height, color, velocity) {
				this.x = x;
				this.y = y;
				this.width = width;
				this.height = height;
				this.color = color;
				this.velocity = velocity;
			}

			drawRectangle() {
				drawRect(this.x, this.y, this.width, this.height,this.color);
			}

			update() {
				this.y = this.y + this.velocity;
			}
		}

		class Bonus{
			constructor(x, y, width, height, color, velocity) {
				this.x = x;
				this.y = y;
				this.width = width;
				this.height = height;
				this.color = color;
				this.velocity = velocity;
			}

			drawRectangle() {
				drawRect(this.x, this.y, this.width, this.height,this.color);
			}

			update() {
				this.y = this.y + this.velocity;
			}
		}

		var c = document.getElementById("myCanvas");
		var ctx = c.getContext("2d");
		var carPositionX = (c.width/2)-100;
		var carPositionY= (c.height)-100;
		var carX = 50; var carY = 80; var velocity =9;
		var rightPressed = false;
		var leftPressed = false;
		var counter = 0; var level =180; 
		var crash=false; var bonusScore = 0;
		let reqAnim;
		var enemies = [];
		var lines = [];
		var bonuses =[];

		function rand(min, max) {
			min = Math.ceil(min);
			max = Math.floor(max);
			return Math.floor(Math.random() * (max - min)) + min;
		}

		document.addEventListener('keydown', function(e) {
			e.preventDefault();
			if (e.keyCode === 39) {
				rightPressed = true;
			}
			if (e.keyCode === 37) {
				leftPressed = true;
			}
		});

		document.addEventListener('keyup', function(e) {
			e.preventDefault();
			if (e.keyCode === 39) {
				rightPressed = false;
			}
			if (e.keyCode === 37) {
				leftPressed = false;
			}
		});

		function drawRect(a,b,c,d,e) {
			ctx.beginPath();
			ctx.rect(a,b,c,d);
			ctx.fillStyle = e;
			ctx.fill();
			ctx.closePath();
		};

		function drawRoad(){
			drawRect(100, 0, 450, 600,"gray");
			drawRect(0, 0, 50, 600,"green");
			drawRect(600, 0, 50, 600,"green");
			drawRect(650, 0, 150, 600,"black");
		};

		function drawScore(x,y,z,a) {
			ctx.font = "24px Arial";
			ctx.fillStyle = "White";
			ctx.fillText(a + z, x, y);
		}

		function stopAnimation() {
		window.cancelAnimationFrame(reqAnim);
		}

		function animate(){
			ctx.clearRect(0,0, 800,600);
			reqAnim= window.requestAnimationFrame(animate);

			counter+=1;
			if (rightPressed && carPositionX<500) {
        		 carPositionX += velocity;
    		} else if (leftPressed && carPositionX>100) {
        		carPositionX -= velocity;
    		};

			drawRoad();
			//lines
			if(counter%20==0){
				lines.push(new Line(50,-100,50,70,"red",7));
				lines.push(new Line(550,-100,50,70,"red",7));
				lines.push(new Line(185,-100,10,70,"white",7));
				lines.push(new Line(275,-100,10,70,"white",7));
				lines.push(new Line(365,-100,10,70,"white",7));
				lines.push(new Line(455,-100,10,70,"white",7));
			};
			lines.forEach(function (line, i) {
				line.drawRectangle();
				line.update();
				if(line.y > c.height + 100) lines.splice(i, 1);
			});
			//bonuses
			if(counter%level==0) bonuses.push(new Bonus(rand(100,500),-100,20,20,"Blue",8));
			bonuses.forEach(function (bonus, i) {
				bonus.drawRectangle();
				bonus.update();
				if(carPositionX < bonus.x + bonus.width && carPositionX + carX > bonus.x && carPositionY < bonus.y + bonus.height && carY + carPositionY > bonus.y){
					bonusScore+=50;
					bonuses.splice(i, 1);
				};
				if(bonus.y > c.height + 100) bonuses.splice(i, 1);
			});
			//enemies
			if(counter%level==0) enemies.push(new Enemy(rand(100,500),-100,carX,carY,"Black",3));
			enemies.forEach(function (enemy, i) {
				enemy.drawRectangle();
				enemy.update();
				if(carPositionX < enemy.x + enemy.width && carPositionX + carX > enemy.x && carPositionY < enemy.y + enemy.height && carY + carPositionY > enemy.y){
					stopAnimation();
					window.alert("Przegrałeś!\nTwój wynik to: " + (counter+bonusScore) + "\nOdśwież stronę aby zacząć od nowa.");
				};
				if(enemy.y > c.height + 100) enemies.splice(i, 1);
			});

			drawRect(carPositionX, carPositionY, carX, carY,"Black");
			drawScore(655,c.height/2,counter,"Wynik: ");
			drawScore(655,(c.height/2)+30,bonusScore,"Bonus: ");

		};
	animate();

	</script>
</html>